<script setup>
import { ref, computed, onMounted } from 'vue'
import { useRoute } from 'vue-router'
import PostCard from '../../components/blog/PostCard.vue'
import Sidebar from '../../components/sidebar/Sidebar.vue'

const route = useRoute()
const categoryName = computed(() => route.params.name)

// Ê®°ÊãüÊñáÁ´†Êï∞ÊçÆ
const allPosts = ref([
  {
    id: 1,
    title: 'Êé¢Á¥¢‰∫∫Â∑•Êô∫ËÉΩÁöÑËæπÁïåÔºö‰ªéÊú∫Âô®Â≠¶‰π†Âà∞Ê∑±Â∫¶ÊÄùËÄÉ',
    excerpt: 'Âú®Ëøô‰∏™Âø´ÈÄüÂèëÂ±ïÁöÑÊï∞Â≠óÊó∂‰ª£Ôºå‰∫∫Â∑•Êô∫ËÉΩ‰∏çÂÜçÊòØÁßëÂπªÂ∞èËØ¥‰∏≠ÁöÑÊ¶ÇÂøµÔºåËÄåÊòØÊàë‰ª¨Êó•Â∏∏ÁîüÊ¥ªÁöÑ‰∏ÄÈÉ®ÂàÜ„ÄÇÊú¨ÊñáÂ∞ÜÊ∑±ÂÖ•Êé¢ËÆ®AIÊäÄÊúØÁöÑÂèëÂ±ïÂéÜÁ®ã...',
    date: '2024Âπ¥1Êúà15Êó•',
    tags: ['‰∫∫Â∑•Êô∫ËÉΩ', 'Êú∫Âô®Â≠¶‰π†', 'Ê∑±Â∫¶Â≠¶‰π†'],
    views: 1234,
    category: 'ÊäÄÊúØÊÄùËÄÉ',
    image: 'https://images.unsplash.com/photo-1677442136019-21780ecad995'
  },
  {
    id: 2,
    title: 'Vue.js 3.0 ÂÆûË∑µÂøÉÂæó',
    excerpt: 'Vue 3.0 Â∏¶Êù•‰∫ÜËÆ∏Â§ö‰ª§‰∫∫ÂÖ¥Â•ãÁöÑÊñ∞ÁâπÊÄßÔºåÂåÖÊã¨ Composition API„ÄÅÊõ¥Â•ΩÁöÑ TypeScript ÊîØÊåÅÁ≠â„ÄÇÊú¨ÊñáÂàÜ‰∫´ÊàëÂú®ÂÆûÈôÖÈ°πÁõÆ‰∏≠ÁöÑ‰ΩøÁî®ÁªèÈ™å...',
    date: '2024Âπ¥1Êúà10Êó•',
    tags: ['Vue.js', 'ÂâçÁ´ØÂºÄÂèë', 'JavaScript'],
    views: 856,
    category: 'ÊäÄÊúØÊÄùËÄÉ',
    image: 'https://images.unsplash.com/photo-1633356122544-f134324a6cee'
  },
  {
    id: 3,
    title: 'ÂâçÁ´ØÂ∑•Á®ãÂåñÁöÑÊÄùËÄÉ',
    excerpt: 'ÈöèÁùÄÂâçÁ´ØÈ°πÁõÆÂ§çÊùÇÂ∫¶ÁöÑÂ¢ûÂä†ÔºåÂ∑•Á®ãÂåñÂèòÂæóË∂äÊù•Ë∂äÈáçË¶Å„ÄÇÊú¨ÊñáÊé¢ËÆ®‰∫ÜÁé∞‰ª£ÂâçÁ´ØÂ∑•Á®ãÂåñÁöÑÊúÄ‰Ω≥ÂÆûË∑µ...',
    date: '2024Âπ¥1Êúà5Êó•',
    tags: ['Â∑•Á®ãÂåñ', 'ÊûÑÂª∫Â∑•ÂÖ∑', 'Webpack'],
    views: 642,
    category: 'ÊäÄÊúØÊÄùËÄÉ',
    image: 'https://images.unsplash.com/photo-1555066931-4365d14bab8c'
  },
  {
    id: 4,
    title: 'ÂüéÂ∏ÇÊº´Ê≠•ÔºöÂèëÁé∞Ë∫´ËæπÁöÑÁæé‰∏Ω',
    excerpt: 'Âú®ÂøôÁ¢åÁöÑÁîüÊ¥ª‰∏≠ÔºåÊàë‰ª¨Â∏∏Â∏∏ÂøΩÁï•‰∫ÜË∫´ËæπÁöÑÁæéÊôØ„ÄÇËøôÊ¨°ÂüéÂ∏ÇÊº´Ê≠•ËÆ©ÊàëÈáçÊñ∞ÂèëÁé∞‰∫ÜÁîüÊ¥ªÁöÑÁæéÂ•Ω...',
    date: '2024Âπ¥1Êúà12Êó•',
    tags: ['ÁîüÊ¥ª', 'ÊëÑÂΩ±', 'ÂüéÂ∏Ç'],
    views: 423,
    category: 'ÁîüÊ¥ªÈöèÁ¨î',
    image: 'https://images.unsplash.com/photo-1449824913935-59a10b8d2000'
  },
  {
    id: 5,
    title: 'ÂíñÂï°È¶ÜÈáåÁöÑÊÄùËÄÉÊó∂ÂÖâ',
    excerpt: 'ÂçàÂêéÁöÑÂíñÂï°È¶ÜÔºåÈò≥ÂÖâÈÄèËøáÁ™óÊà∑Ê¥íÂú®Ê°å‰∏äÔºåËøôÊòØÊàëÊúÄÂñúÊ¨¢ÁöÑÊÄùËÄÉÊó∂ÂÖâ„ÄÇÂú®ËøôÈáåÔºåÊó∂Èó¥‰ªø‰ΩõÊÖ¢‰∫Ü‰∏ãÊù•...',
    date: '2024Âπ¥1Êúà8Êó•',
    tags: ['ÁîüÊ¥ª', 'ÊÄùËÄÉ', 'ÂíñÂï°'],
    views: 367,
    category: 'ÁîüÊ¥ªÈöèÁ¨î',
    image: 'https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb'
  },
  {
    id: 6,
    title: '„ÄäÊ∑±Â∫¶Â∑•‰Ωú„ÄãËØªÂêéÊÑü',
    excerpt: 'Âú®Ëøô‰∏™‰ø°ÊÅØÁàÜÁÇ∏ÁöÑÊó∂‰ª£ÔºåÂ¶Ç‰Ωï‰øùÊåÅ‰∏ìÊ≥®Êàê‰∏∫‰∫Ü‰∏Ä‰∏™ÈáçË¶ÅËØæÈ¢ò„ÄÇ„ÄäÊ∑±Â∫¶Â∑•‰Ωú„ÄãËøôÊú¨‰π¶Áªô‰∫ÜÊàëÂæàÂ§öÂêØÂèë...',
    date: '2024Âπ¥1Êúà14Êó•',
    tags: ['ËØª‰π¶', 'ÊïàÁéá', '‰∏ìÊ≥®'],
    views: 789,
    category: 'ËØª‰π¶Á¨îËÆ∞',
    image: 'https://images.unsplash.com/photo-1481627834876-b7833e8f5570'
  }
])

// Ê†πÊçÆÂàÜÁ±ªÁ≠õÈÄâÊñáÁ´†
const filteredPosts = computed(() => {
  return allPosts.value.filter(post => post.category === categoryName.value)
})

// ÂàÜÁ±ª‰ø°ÊÅØ
const categoryInfo = computed(() => {
  const categoryMap = {
    'ÊäÄÊúØÊÄùËÄÉ': {
      description: 'ÂÖ≥‰∫éÁºñÁ®ã„ÄÅÊäÄÊúØÂèëÂ±ïÂíåËΩØ‰ª∂Â∑•Á®ãÁöÑÊÄùËÄÉ',
      color: '#3498db',
      icon: 'üíª'
    },
    'ÁîüÊ¥ªÈöèÁ¨î': {
      description: 'ËÆ∞ÂΩïÁîüÊ¥ª‰∏≠ÁöÑÁÇπÁÇπÊª¥Êª¥ÂíåÊÑüÊÇü',
      color: '#e74c3c',
      icon: 'üìù'
    },
    'ËØª‰π¶Á¨îËÆ∞': {
      description: 'ÈòÖËØªÂøÉÂæóÂíå‰π¶Á±çÊé®Ëçê',
      color: '#f39c12',
      icon: 'üìö'
    },
    'ÊóÖË°åËßÅÈóª': {
      description: 'ÊóÖÈÄî‰∏≠ÁöÑËßÅÈóªÂíåÊëÑÂΩ±‰ΩúÂìÅ',
      color: '#27ae60',
      icon: 'üåç'
    }
  }
  return categoryMap[categoryName.value] || {
    description: 'ÂàÜÁ±ªÊñáÁ´†',
    color: '#95a5a6',
    icon: 'üìÑ'
  }
})

// ÂàÜÈ°µÁõ∏ÂÖ≥
const currentPage = ref(1)
const postsPerPage = 5
const totalPages = computed(() => Math.ceil(filteredPosts.value.length / postsPerPage))

const paginatedPosts = computed(() => {
  const start = (currentPage.value - 1) * postsPerPage
  const end = start + postsPerPage
  return filteredPosts.value.slice(start, end)
})

const changePage = (page) => {
  currentPage.value = page
  window.scrollTo({ top: 0, behavior: 'smooth' })
}
</script>

<template>
  <div class="container">
    <div class="category-detail-page">
      <!-- ÂàÜÁ±ªÂ§¥ÈÉ® -->
      <div class="category-header">
        <div class="category-info">
          <div class="category-icon" :style="{ backgroundColor: categoryInfo.color }">
            {{ categoryInfo.icon }}
          </div>
          <div class="category-text">
            <h1>{{ categoryName }}</h1>
            <p>{{ categoryInfo.description }}</p>
            <div class="category-stats">
              <span>ÂÖ± {{ filteredPosts.length }} ÁØáÊñáÁ´†</span>
            </div>
          </div>
        </div>
        
        <!-- Èù¢ÂåÖÂ±ëÂØºËà™ -->
        <nav class="breadcrumb">
          <router-link to="/">È¶ñÈ°µ</router-link>
          <span class="separator">></span>
          <router-link to="/category">ÂàÜÁ±ª</router-link>
          <span class="separator">></span>
          <span class="current">{{ categoryName }}</span>
        </nav>
      </div>

      <div class="main-content">
        <div class="content-area">
          <!-- ÊñáÁ´†ÂàóË°® -->
          <div v-if="paginatedPosts.length > 0" class="posts-list">
            <PostCard 
              v-for="post in paginatedPosts" 
              :key="post.id" 
              :post="post" 
            />
          </div>
          
          <!-- Á©∫Áä∂ÊÄÅ -->
          <div v-else class="empty-state">
            <div class="empty-icon">üìù</div>
            <h3>ÊöÇÊó†ÊñáÁ´†</h3>
            <p>ËØ•ÂàÜÁ±ª‰∏ãËøòÊ≤°ÊúâÊñáÁ´†ÔºåÊï¨ËØ∑ÊúüÂæÖÔºÅ</p>
            <router-link to="/" class="back-home">ËøîÂõûÈ¶ñÈ°µ</router-link>
          </div>

          <!-- ÂàÜÈ°µ -->
          <div v-if="totalPages > 1" class="pagination">
            <button 
              v-if="currentPage > 1"
              @click="changePage(currentPage - 1)"
              class="page-btn"
            >
              ‚Üê ‰∏ä‰∏ÄÈ°µ
            </button>
            
            <button
              v-for="page in totalPages"
              :key="page"
              @click="changePage(page)"
              :class="['page-btn', { active: currentPage === page }]"
            >
              {{ page }}
            </button>
            
            <button 
              v-if="currentPage < totalPages"
              @click="changePage(currentPage + 1)"
              class="page-btn"
            >
              ‰∏ã‰∏ÄÈ°µ ‚Üí
            </button>
          </div>
        </div>
        
        <Sidebar />
      </div>
    </div>
  </div>
</template>

<style lang="scss" scoped>
.category-detail-page {
  margin: 30px 0;
}

.category-header {
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  padding: 40px;
  margin-bottom: 30px;
}

.category-info {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 20px;
}

.category-icon {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5em;
  color: white;
}

.category-text {
  h1 {
    font-size: 2.2em;
    color: var(--dark-color);
    margin-bottom: 8px;
  }

  p {
    color: #666;
    font-size: 1.1em;
    margin-bottom: 10px;
  }
}

.category-stats {
  span {
    background: var(--light-color);
    color: #666;
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 0.9em;
  }
}

.breadcrumb {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.9em;

  a {
    color: var(--primary-color);
    text-decoration: none;

    &:hover {
      text-decoration: underline;
    }
  }

  .separator {
    color: #999;
  }

  .current {
    color: #666;
  }
}

.main-content {
  display: flex;
  gap: 30px;
}

.content-area {
  flex: 2;
}

.posts-list {
  display: flex;
  flex-direction: column;
  gap: 25px;
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);

  .empty-icon {
    font-size: 3em;
    margin-bottom: 20px;
  }

  h3 {
    color: var(--dark-color);
    margin-bottom: 10px;
  }

  p {
    color: #666;
    margin-bottom: 30px;
  }

  .back-home {
    display: inline-block;
    background: var(--primary-color);
    color: white;
    padding: 12px 24px;
    border-radius: 6px;
    text-decoration: none;
    transition: background-color 0.3s;

    &:hover {
      background: var(--secondary-color);
    }
  }
}

.pagination {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 40px;
}

.page-btn {
  padding: 10px 16px;
  border: 1px solid #ddd;
  background: white;
  color: var(--text-color);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s;

  &:hover {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
  }

  &.active {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
  }
}

/* Â§úÈó¥Ê®°ÂºèÊ†∑Âºè */
.dark-mode .category-header {
  background: #3f3f3f;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
}

.dark-mode .category-text p {
  color: var(--text-color);
}

.dark-mode .category-stats span {
  background: var(--light-color);
  color: var(--text-color);
}

.dark-mode .breadcrumb .separator {
  color: #aaa;
}

.dark-mode .breadcrumb .current {
  color: var(--text-color);
}

.dark-mode .empty-state {
  background: #3f3f3f;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);

  h3 {
    color: var(--dark-color);
  }

  p {
    color: var(--text-color);
  }
}

.dark-mode .page-btn {
  border: 1px solid var(--border-color);
  background: #3f3f3f;
  color: var(--text-color);

  &:hover {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
  }

  &.active {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
  }
}

@media (max-width: 992px) {
  .main-content {
    flex-direction: column;
  }

  .category-header {
    padding: 30px 20px;
  }

  .category-info {
    flex-direction: column;
    text-align: center;
    gap: 15px;
  }

  .pagination {
    flex-wrap: wrap;
  }
}
</style>